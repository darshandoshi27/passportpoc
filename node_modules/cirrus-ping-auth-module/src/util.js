import nonce from 'nonce';

import log from './logger';

let authEnabled = (process.env.AUTH_ENABLED === 'true' || process.env.AUTH_REQUIRED === 'true');

/**
 * Ensure that environment variables are set up correctly
 * @return {boolean} Is auth enabled?
 */
export const checkEnvironment = () => {
  if (!authEnabled) {
    log.warn('Auth is disabled.');
    log.info('Set AUTH_ENABLED to true in your environment variables');
  } else {
    log.success('Auth is enabled. Using PING flow.');
  }

  // check that all environment variables are present
  if (!('OPENID_CLIENT_ID' in process.env)) {
    log.error('You appear to be missing OPENID_CLIENT_ID from your environment variables');
    log.error('The Ping auth flow will not work without this!');
    log.error('Auth has been disabled due to misconfiguration.');
    authEnabled = false;
  }

  return authEnabled;
};

/**
 * Generate a nonce of 15 chars
 * @return {string} nonce
 */
export const generateNonce = (len = 15) => `${nonce(len)()}`;
