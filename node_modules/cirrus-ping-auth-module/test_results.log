> cirrus-ping-auth-module@3.0.1 test /home/jenkins/workspace/rus-ping-auth-module_v3.0.1-2Y5XOO4LLDQ4HDNIHG6KYNIUYMYVVUOI3VFNAD6B6KVJF7VZDSXA
> gulp && nyc mocha --timeout=3000

[17:22:50] Using gulpfile ~/workspace/rus-ping-auth-module_v3.0.1-2Y5XOO4LLDQ4HDNIHG6KYNIUYMYVVUOI3VFNAD6B6KVJF7VZDSXA/gulpfile.js
[17:22:50] Starting 'default'...
[17:22:50] Starting 'build'...
[17:22:50] Starting 'doc'...
[17:22:52] Finished 'build' after 1.86 s
[17:22:53] Documented 4 files!
[17:22:53] Finished 'doc' after 2.78 s
[17:22:53] Finished 'default' after 2.79 s
[AUTH] Auth is enabled. Using PING flow.


  Util.js
    should warn when auth is disabled
[AUTH] Auth is disabled.
[AUTH] Set AUTH_ENABLED to true in your environment variables
      ✓ should warn that auth is disabled

  Logging framework
    logs when logging is enabled
[AUTH] test log.error
      ✓ should be able to log with .error
[AUTH] test log.warn
      ✓ should be able to log with .warn
[AUTH] test log.success
      ✓ should be able to log with .success
[AUTH] test log.info
      ✓ should be able to log with .info
[AUTH] test log.plain
      ✓ should be able to log with .plain
    no log when logging is disabled
[AUTH] : Logs are disabled.
      ✓ should not log with .error
      ✓ should not log with .warn
      ✓ should not log with .success
      ✓ should not log with .info
      ✓ should not log with .plain

  Cirrus Ping Module
    #authenticate
      ✓ should exist
[AUTH] Could not discover OpenID issuer, retrying...
[AUTH] Discovered issuer: https://federate-qa.xh1.lilly.com
      ✓ should add middleware to express (70ms)
    #ignore
      ✓ should accept an array as a parameter
      ✓ should accept multiple parameters
    #authMiddleware
[AUTH] Serving /ignored to verified user
      ✓ should invoke next() if path is in ignored routes
      ✓ should not redirect an authenticated user
    /auth/userid
[AUTH] Serving /auth/userid to verified user
      ✓ should respond with json (49ms)
    /login
[AUTH] Serving /login to verified user
      ✓ should redirect user to federation server
[AUTH] User has been authenticated: undefined
      ✓ should fetch user details from tokenset
    /logout
[AUTH] Serving /login to verified user
      ✓ should log out user and redirect to correct url
    /auth/ping/callback
[AUTH] Serving /auth/ping/callback to verified user
      ✓ should send contents of authClientSide.html


  22 passing (247ms)

--------------|----------|----------|----------|----------|-------------------|
File          |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
--------------|----------|----------|----------|----------|-------------------|
All files     |    88.71 |    78.08 |    90.91 |    88.24 |                   |
 endpoints.js |    94.74 |       75 |      100 |    94.74 |             53,55 |
 index.js     |    85.96 |    79.49 |    84.21 |    84.91 |... 63,102,103,104 |
 logger.js    |      100 |      100 |      100 |      100 |                   |
 util.js      |       75 |       70 |      100 |    73.33 |       21,22,23,24 |
--------------|----------|----------|----------|----------|-------------------|